webpackJsonp([1],{"3/LM":function(e,t){},"7zck":function(e,t){},BZC6:function(e,t){},"L+Dk":function(e,t){},NHnr:function(e,t,n){"use strict";function a(e){return window.fetch(T+"/raids",{body:w()(e),method:"POST",headers:{"content-type":"application/json"}}).then(function(e){return e.json()})}function r(e){return window.fetch(T+"/raids/"+e.id,{body:w()(e),method:"PUT",headers:{"content-type":"application/json"}}).then(function(e){return e.json()})}function i(e,t){return window.fetch(T+"/raids/"+e+"/players",{body:w()(t),method:"POST",headers:{"content-type":"application/json"}}).then(function(e){return e.json()})}function o(){var e=new Date,t=new Date(e.getTime()-27e5),n=new Date(e.getTime()+36e5);return window.fetch(T+"/raids?start="+t.toISOString()+"&end="+n.toISOString()).then(function(e){return e.json()})}function s(e){var e=new Date(e);return e.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"})}function c(e){var t=e.split(":"),n=M()(t,2),a=n[0],r=n[1],i=new Date;return i.setHours(a,r),i}function u(e){n("BZC6")}function d(e){n("Z5FK")}function l(e){n("L+Dk")}function m(e){n("3/LM")}Object.defineProperty(t,"__esModule",{value:!0});var p=n("7+uW"),f=n("BO1k"),v=n.n(f),h=n("Xxa5"),g=n.n(h),y=n("exGp"),b=n.n(y),_=n("mvHQ"),w=n.n(_),x=function(){var e=b()(g.a.mark(function e(){return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(O.length){e.next=4;break}return e.next=3,window.fetch(T+"/gyms").then(function(e){return e.json()});case 3:O=e.sent;case 4:return e.abrupt("return",O);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),k=function(){var e=b()(g.a.mark(function e(t){return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x();case 2:return e.t0=function(e){return e.id===t},e.t1=function(e,t){return t},e.t2={},e.abrupt("return",e.sent.filter(e.t0).reduce(e.t1,e.t2));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),T="https://pokemongogymmap.herokuapp.com",O=[],R=n("d7EF"),M=n.n(R),D={props:["raid"],data:function(){return{selectedGym:null,timeOfPop:"",startTime:"",gyms:[],error:"",toast:{visible:!1,text:""},valid:!1,validationRules:{timeFormat:function(e){return!e||/^[0-9]{2}:[0-9]{2}$/.test(e)||"Format incorrect : HH:MM attendu"},required:function(e){return!!e||"Champ obligatoire"}}}},created:function(){var e=this;return b()(g.a.mark(function t(){return g.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x();case 2:e.gyms=t.sent;case 3:case"end":return t.stop()}},t,e)}))()},watch:{raid:function(){var e=this;this.raid&&(this.gyms.filter(function(t){return e.raid.gym.id===t.id}).forEach(function(t){e.selectedGym=t}),this.timeOfPop=s(this.raid.hatchTime),this.raid.raidStartTime&&(this.startTime=s(this.raid.raidStartTime)))}},methods:{saveRaid:function(){var e=this;return b()(g.a.mark(function t(){var n,i,o;return g.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$refs.manageRaidForm.validate()){t.next=2;break}return t.abrupt("return");case 2:if(n=c(e.timeOfPop),i=e.startTime?c(e.startTime):null,o=void 0,!e.raid){t.next=11;break}return t.next=8,r({id:e.raid.id,gymId:e.selectedGym.id,hatchTime:n.toISOString(),raidStartTime:i?i.toISOString():""}).catch(function(e){return e});case 8:o=t.sent,t.next=14;break;case 11:return t.next=13,a({gymId:e.selectedGym.id,hatchTime:n.toISOString(),raidStartTime:i?i.toISOString():""}).catch(function(e){return e});case 13:o=t.sent;case 14:e.error=o.message,e.error||(e.resetFields(),e.$emit("raidModified",{message:"Raid enregistré avec succès"}),e.$modal.hide("raid"));case 16:case"end":return t.stop()}},t,e)}))()},beforeClose:function(){this.$emit("closeModal")},resetFields:function(){this.$refs.manageRaidForm.reset()}}},S=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("modal",{attrs:{name:"raid",height:"auto",adaptive:!0},on:{"before-close":function(t){e.beforeClose()}}},[n("v-container",{attrs:{fluid:""}},[n("div",{staticClass:"sp-close",on:{click:function(t){e.$modal.hide("raid")}}},[e._v("×")]),e._v(" "),n("h2",[e._v(e._s(e.raid?"Modifier":"Ajouter")+" un raid 5 ★")]),e._v(" "),n("v-form",{ref:"manageRaidForm",attrs:{"lazy-validation":!0},on:{submit:function(t){t.preventDefault(),e.saveRaid()}},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[n("v-select",{attrs:{items:e.gyms,disabled:!!e.raid,"item-text":"name",label:"Nom de l'arène",autocomplete:"","max-height":200,rules:[e.validationRules.required],required:""},model:{value:e.selectedGym,callback:function(t){e.selectedGym=t},expression:"selectedGym"}}),e._v(" "),n("v-text-field",{attrs:{label:"Heure du pop",rules:[e.validationRules.required,e.validationRules.timeFormat],placeholder:"Au format HH:MM ex : 14:45","validate-on-blur":!0,mask:"##:##","return-masked-value":!0,required:""},model:{value:e.timeOfPop,callback:function(t){e.timeOfPop=t},expression:"timeOfPop"}}),e._v(" "),n("v-text-field",{attrs:{label:"On lance à",rules:[e.validationRules.timeFormat],placeholder:"Au format HH:MM ex : 14:45","validate-on-blur":!0,mask:"##:##","return-masked-value":!0},model:{value:e.startTime,callback:function(t){e.startTime=t},expression:"startTime"}}),e._v(" "),n("v-btn",{on:{click:function(t){e.saveRaid()}}},[e._v("Enregistrer")])],1),e._v(" "),n("v-alert",{attrs:{type:"error",value:e.error}},[e._v(e._s(e.error))])],1)],1)},P=[],A={render:S,staticRenderFns:P},I=A,C=n("VU/8"),F=u,$=C(D,I,!1,F,"data-v-377caa81",null),j=$.exports,N={props:["raid"],data:function(){return{selectedGymName:"",numberOfAccounts:1,startTime:"",players:[],playerNames:"",numberOfPlayers:0,pseudo:"",error:"",toast:{visible:!1,text:""},valid:!1,validationRules:{required:function(e){return!!e||"Champ obligatoire"}}}},watch:{raid:function(){this.pseudo=localStorage.getItem("nickname"),this.raid&&(this.selectedGymName=this.raid.gym.name,this.players=this.raid.players,this.players&&(this.numberOfPlayers=this.players.map(function(e){return e.accounts}).reduce(function(e,t){return e+t},0),this.playerNames=this.players.map(function(e){return e.nickname+(e.accounts>1?" ("+e.accounts+")":"")}).join(", ")),this.raid.raidStartTime&&(this.startTime=s(this.raid.raidStartTime))),this.numberOfAccounts=1}},methods:{saveRaid:function(){var e=this;return b()(g.a.mark(function t(){var n;return g.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$refs.managePlayersForm.validate()){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,i(e.raid.id,{nickname:e.pseudo,accounts:e.numberOfAccounts}).catch(function(e){return e});case 4:n=t.sent,e.error=n.message,e.error||(localStorage.setItem("nickname",e.pseudo),e.$emit("playerAdded",{message:"Participants enregistrés avec succès"}),e.resetFields(),e.$modal.hide("player"));case 7:case"end":return t.stop()}},t,e)}))()},beforeClose:function(){this.$emit("closeModal")},resetFields:function(){this.$refs.managePlayersForm.reset()}}},H=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("modal",{attrs:{name:"player",height:"auto",adaptive:!0},on:{"before-close":function(t){e.beforeClose()}}},[n("v-container",{attrs:{fluid:""}},[n("div",{staticClass:"sp-close",on:{click:function(t){e.$modal.hide("player")}}},[e._v("×")]),e._v(" "),n("h2",[e._v("Ajouter un participant à un raid")]),e._v(" "),n("div",{staticStyle:{margin:"auto","margin-top":"10px","text-align":"center",width:"70%"}},[n("strong",[e._v(e._s(e.selectedGymName))]),n("br"),e._v(" "),n("strong",[e._v("On lance à :")]),e._v(" "+e._s(e.startTime?e.startTime:"-")),n("br"),e._v(" "),n("strong",[e._v(e._s(e.numberOfPlayers)+" participants :")]),e._v(" "+e._s(e.playerNames)+"\n    ")]),e._v(" "),n("v-form",{ref:"managePlayersForm",attrs:{"lazy-validation":!0},on:{submit:function(t){t.preventDefault(),e.saveRaid()}},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[n("v-text-field",{attrs:{label:"Mon pseudo",rules:[e.validationRules.required],"validate-on-blur":!0,required:""},model:{value:e.pseudo,callback:function(t){e.pseudo=t},expression:"pseudo"}}),e._v(" "),n("v-text-field",{attrs:{label:"Nombre de comptes","validate-on-blur":!0,rules:[e.validationRules.required],required:""},model:{value:e.numberOfAccounts,callback:function(t){e.numberOfAccounts=e._n(t)},expression:"numberOfAccounts"}}),e._v(" "),n("v-btn",{on:{click:function(t){e.saveRaid()}}},[e._v("Enregistrer")])],1),e._v(" "),n("v-alert",{attrs:{type:"error",value:e.error}},[e._v(e._s(e.error))])],1)],1)},E=[],G={render:H,staticRenderFns:E},q=G,z=n("VU/8"),Z=d,U=z(N,q,!1,Z,"data-v-13eafd66",null),V=U.exports,B=n("bOdI"),K=n.n(B),J=K()({props:["raid"],data:function(){return{remaining:{}}},methods:{},created:function(){this.hacthTimeasDate=new Date(this.raid.hatchTime),this.calcRemaining()}},"methods",{calcRemaining:function(){var e=new Date;e.getTime()<this.hacthTimeasDate.getTime()?this.remaining={type:"unhatched",time:this.hacthTimeasDate.getTime()-e.getTime()}:this.remaining={type:"ongoing",time:this.hacthTimeasDate.getTime()+27e5-e.getTime()}},remainingType:function(){return(new Date).getTime()<this.hacthTimeasDate.getTime()?"unhatched":"ongoing"}}),Q=function(){var e=this,t=e.$createElement;return(e._self._c||t)("countdown",{staticClass:"countdown",class:e.remaining.type,attrs:{time:e.remaining.time},on:{countdownend:function(t){e.calcRemaining()}},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.hours)+":"+e._s(t.minutes)+":"+e._s(t.seconds))]}}])})},W=[],X={render:Q,staticRenderFns:W},Y=X,ee=n("VU/8"),te=l,ne=ee(J,Y,!1,te,null,null),ae=ne.exports,re={data:function(){return{map:{center:[48.828036,2.32696]},gyms:[],tileLayers:[],markers:[],selectedRaid:{},showAddImage:!0,loading:!1,toast:{visible:!1,text:""},location:{position:null,loading:!1}}},components:{ManageRaid:j,AddPlayer:V,RaidCountDown:ae},created:function(){var e=this;return b()(g.a.mark(function t(){return g.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.tileLayers.push({url:"https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.{ext}",options:{attribution:'Map tiles by\n          <a href="http://stamen.com">Stamen Design</a>,\n          <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy;\n          <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',subdomains:"abcd",minZoom:0,maxZoom:20,ext:"png"}}),e.loadData(),setInterval(function(){return e.loadData()},2e4);case 3:case"end":return t.stop()}},t,e)}))()},methods:{toPrintedDate:s,showAddRaid:function(e){this.selectedRaid=e,this.showAddImage=!1,this.$modal.show("raid")},showAddPlayer:function(e){this.selectedRaid=e,this.showAddImage=!1,this.$modal.show("player")},getNumberOfPlayers:function(e){return e.players?e.players.map(function(e){return e.accounts}).reduce(function(e,t){return e+t},0):0},buildTooltipOptions:function(){return{permanent:!0,opacity:1,offset:new L.Point(0,-50),direction:"top"}},getEndDate:function(e){return s(new Date(new Date(e).getTime()+27e5))},raidModified:function(e){this.showToast(e.message),this.loadData()},closeModal:function(){this.showAddImage=!0},addCoordinates:function(e){var t=this;return b()(g.a.mark(function n(){var a,r,i,o,s,c;return g.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a=!0,r=!1,i=void 0,t.prev=3,o=v()(e);case 5:if(a=(s=o.next()).done){t.next=13;break}return c=s.value,t.next=9,k(c.gymId);case 9:c.gym=t.sent;case 10:a=!0,t.next=5;break;case 13:t.next=19;break;case 15:t.prev=15,t.t0=t.catch(3),r=!0,i=t.t0;case 19:t.prev=19,t.prev=20,!a&&o.return&&o.return();case 22:if(t.prev=22,!r){t.next=25;break}throw i;case 25:return t.finish(22);case 26:return t.finish(19);case 27:return t.abrupt("return",e);case 28:case"end":return t.stop()}},n,t,[[3,15,19,27],[20,,22,26]])}))()},buildIcon:function(e){return new L.DivIcon({iconSize:[50,50],iconAnchor:[25,50],popupAnchor:[0,-50],html:'<div class="gym-marker '+(e.ex_eligible?"gym-ex":"")+'"></div>'})},loadData:function(){var e=this;return b()(g.a.mark(function t(){var n,a,r,i,s,c,u;return g.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!0,t.t0=e,t.next=4,o();case 4:return t.t1=t.sent,t.next=7,t.t0.addCoordinates.call(t.t0,t.t1);case 7:for(n=t.sent,e.markers=[],a=!0,r=!1,i=void 0,t.prev=12,s=v()(n);!(a=(c=s.next()).done);a=!0)u=c.value,e.markers.push({id:u.id,raid:u,latLng:{lat:u.gym.latitude,lng:u.gym.longitude},icon:e.buildIcon(u.gym)});t.next=20;break;case 16:t.prev=16,t.t2=t.catch(12),r=!0,i=t.t2;case 20:t.prev=20,t.prev=21,!a&&s.return&&s.return();case 23:if(t.prev=23,!r){t.next=26;break}throw i;case 26:return t.finish(23);case 27:return t.finish(20);case 28:e.loading=!1;case 29:case"end":return t.stop()}},t,e,[[12,16,20,28],[21,,23,27]])}))()},showToast:function(e){this.toast.text=e,this.toast.visible=!0},toggleLocation:function(){var e=this;console.log("enable location"),this.location.loading=!0,navigator.geolocation.getCurrentPosition(function(t){console.log("current position",t),e.location.position={latLng:{lat:t.coords.latitude,lng:t.coords.longitude},icon:new L.DivIcon({html:'<span class="location-badge"><i class="fas fa-circle"></i></span>'})},e.map.center=[t.coords.latitude,t.coords.longitude],e.location.loading=!1},function(t){console.log("unable to get location",t),e.location.loading=!1})}}},ie=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("v-app",[n("v-map",{attrs:{zoom:15,center:e.map.center}},[e._l(e.tileLayers,function(e){return n("v-tilelayer",{key:e.url,attrs:{url:e.url,options:e.options}})}),e._v(" "),e._l(e.markers,function(t){return n("v-marker",{key:t.id,attrs:{"lat-lng":t.latLng,icon:t.icon,options:t.options}},[t.raid?n("v-popup",[n("div",{staticStyle:{width:"150px","text-align":"center"}},[n("div",{staticClass:"gymName"},[e._v(e._s(t.raid.gym.name))]),e._v("\n            5 ★"),n("br"),e._v("\n            Pop : "+e._s(e.toPrintedDate(t.raid.hatchTime))),n("br"),e._v("\n            Fin : "+e._s(e.getEndDate(t.raid.hatchTime))),n("br"),e._v("\n            On lance à : "+e._s(t.raid.raidStartTime?e.toPrintedDate(t.raid.raidStartTime):"-")),n("br"),e._v(" "),n("a",{attrs:{href:"#"},on:{click:function(n){e.showAddRaid(t.raid)}}},[e._v("Modifier")]),e._v(" "),n("div",{staticStyle:{"margin-top":"10px"}},[n("strong",[e._v(e._s(e.getNumberOfPlayers(t.raid))+" participants")])]),e._v(" "),n("div",[n("a",{attrs:{href:"#"},on:{click:function(n){e.showAddPlayer(t.raid)}}},[e._v("Ajouter un participant")])])])]):e._e(),e._v(" "),t.raid?n("v-tooltip",{attrs:{options:e.buildTooltipOptions()}},[n("raid-count-down",{attrs:{raid:t.raid}})],1):e._e()],1)}),e._v(" "),e.location.position?n("v-marker",{attrs:{"lat-lng":e.location.position.latLng,icon:e.location.position.icon,options:e.location.position.options}}):e._e()],2),e._v(" "),n("manage-raid",{attrs:{raid:e.selectedRaid},on:{raidModified:function(t){e.raidModified(t)},closeModal:function(t){e.closeModal()}}}),e._v(" "),n("add-player",{attrs:{raid:e.selectedRaid},on:{playerAdded:function(t){e.raidModified(t)},closeModal:function(t){e.closeModal()}}}),e._v(" "),e.showAddImage?n("div",{staticClass:"action-add",on:{click:function(t){e.showAddRaid()}}},[n("img",{attrs:{src:"static/assets/add.png"}})]):e._e(),e._v(" "),n("div",{staticClass:"location-action",class:{"infinite-rotate":e.location.loading},on:{click:function(t){e.toggleLocation()}}},[n("i",{staticClass:"fas fa-location-arrow"})]),e._v(" "),n("v-snackbar",{attrs:{timeout:2e3,top:!0},model:{value:e.toast.visible,callback:function(t){e.$set(e.toast,"visible",t)},expression:"toast.visible"}},[e._v("\n      "+e._s(e.toast.text)+"\n      "),n("v-btn",{attrs:{flat:""},nativeOn:{click:function(t){e.toast.visible=!1}}},[e._v("Close")])],1)],1)],1)},oe=[],se={render:ie,staticRenderFns:oe},ce=se,ue=n("VU/8"),de=m,le=ue(re,ce,!1,de,null,null),me=le.exports,pe=n("sUu7"),fe=n("v9es"),ve=n("MdIv"),he=n("rifk"),ge=n.n(he),ye=n("IZMb"),be=n.n(ye),_e=n("3EgV"),we=n.n(_e),xe=(n("7zck"),n("IHMs")),ke=n.n(xe);p.a.config.productionTip=!1,p.a.use(pe.a),p.a.use(ge.a),p.a.use(be.a),p.a.use(we.a,{theme:{primary:ke.a.grey.darken4}}),p.a.component("countdown",fe.a),p.a.component("v-map",ve.Map),p.a.component("v-tilelayer",ve.TileLayer),p.a.component("v-marker",ve.Marker),p.a.component("v-popup",ve.Popup),p.a.component("v-tooltip",ve.Tooltip),new p.a({el:"#app",template:"<App/>",components:{App:me}})},Z5FK:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.84aa4aaa124d782dc59f.js.map